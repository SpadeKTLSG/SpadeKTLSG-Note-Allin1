‍

### Header

Apache Subversion 通常被缩写成 SVN，是一个开放源代码的版本控制系统，Subversion 在 2000 年由 CollabNet Inc 开发，现在发展成为 Apache 软件基金会的一个项目，同样是一个丰富的开发者和用户社区的一部分. 

‍

‍

# 知识

‍

## 基础架构

‍

### 操作svn服务器方式

command-line 命令行方式

GUI-client图形界面方式

‍

### svn服务连接方式

‍

internet网络连接

* apache服务器
* svn服务器

‍

local 本地连接

‍

### svn数据存储方式

* 文件方式：FSFS（推荐使用）
* 数据库方式：BerkeleyDB（伯克利DB）

‍

‍

### 目录结构

* Repositories 仓库：存放被svn管理的项目文件，可以存放源码，文档等；
* Users 用户：创建和编辑用户；
* Groups 权限组：创建和编辑用户组；

‍

‍

# 基础

‍

## 启动

打开VisualAVN Server步骤：在SVN服务器的安装目录下进入bin文件夹，双击VisualAVN Server.msc即可弹出VisualAVN Server窗口

‍

‍

# 实操

参考 [博客园](https://www.cnblogs.com/0zcl/p/7309766.html)

‍

可以选择不同的载体 VisualSVN or TortoiseSVN

用VisualSVN server 服务端和 TortoiseSVN客户端搭配使用

‍

## 安装VisualSVN server 服务端

安装软件一路点到底, 之后进入Win管理控制台

‍

**新建仓库**

Repo右键新建

‍

****建立用户和组+分配权限****

Users右键新建

User    spadek

Pin    2333

‍

Groups右键新建

‍

给用户组设置权限，在MyRepository上单击右键,选择属性

选择Security选项卡, Add用户, 权限设置为Read/Write

‍

‍

## 安装TortoiseSVN客户端

一路确定(语法检查可以不用), 之后打开文件夹看到有图标即为安装成功了

‍

**checkout项目文件**

在Server端的仓库中添加文件, 之后复制URL到ClipBoard

```sql
https://PCSKXRMP/svn/SKtest/
```

‍

**TortoiseSVN图标介绍**

一个新检出的工作复本使用绿色的对勾重载，表示Subversion状态正常

红色感叹号被修改过，且需要提交

加号告诉你有一个文件或者目录已经被计划加入到版本控制中

‍

**TortoiseSVN Client基础操作**

**SVN检出(SVN Checkout)**

    在文件夹或者目录下单击右键 –> 选择SVN检出

    点击后，在弹开窗口的版本库url框中输入版本库的目录地址

‍

**增加(Add)**

在test项目文件下，新建一个b.txt文件，提交到版本库的方法如下2种：

‍

1. 先提到变更列表中，再commit到配置库中，选择新增文件，右键SVN菜单执行“Add“操作提交到”变更列表中”，然后右键SVN菜单执行”SVN Commit”提交到版本库中.
2. 不提交到变更列表中，而是直接commit配置库中，选择该文件，右键svn菜单执行”SVN Commit”操作.

‍

‍

**删除(Delete)**

如果被删除的文件还未入版本库，则可以直接使用操作系统的删除操作删除该文件. 

‍

如果被删除的文件已入版本库，则删除的方法如下：

1. 选择被删除文件，右键svn菜单执行”delete”操作，然后选择被删除文件的父目录，右键svn菜单执行”SVN Commit”
2. 使用操作系统的删除操作删除该文件，然后选择被删除文件的父目录，右键svn菜单执行”SVN Commit”,在变更列表中选择被删除的文件

‍

**改名(Rename)**

修改文件名，选中需要重命名的文件或文件夹右键修改

‍

**SVN还原(SVN Revert)**

右击想要回退的文件或者文件夹，在TortoiseSVN弹出菜单中选择”Update to reversion…”

比如说我们要回退到第10个版本只需要在Revision中填写相应的版本号

‍

**检查更新(Check for modifications)**

此功能可以显示你所做的修改有哪些还没有提交的，此功能不光能看到对文件的修改变化，所有的变化都能看到，包括增加文件或者目录，删除文件或者目录，移动文件或者目录等，如果你点击了检查版本库，那你还可以看到版本库里的改动，既别人提交了哪些文件的改动，你还没更新到本地

‍

**SVN更新(SVN Update)**

更新本地代码与SVN服务器上最新的版本一致，只要在需要更新的文件夹上点击右键或者在文件下空白处点击右键，选择”SVN Update” (获取指定版本中的内容，点击右键执行SVN菜单中的“Update to reversion“)，就可以了. 

‍

**如何解决冲突文件**

对于每个冲突的文件Subversion在你的目录下放置了三个文件 (mine / r4 /r5)

冲突会产生上面的三个文件，有上面3个文件存在肯定提交不了

‍

```java
1.txt.mine 是冲突前自己的文件

内容如下：

aaaasdf11222333 dderderder

1.txt.r4 是冲突前本地的版本文件

内容如下：aaaasdf11222333

1.txt.r5  是别人赶在你之前提交的版本

内容如下： b
```

‍

其中,<<<<<<<<.mine .....=======之间的代码是你自己的，而======......>>>>>>>.r5是别人与你冲突的代码部分

这样就不难理解为什么会产生冲突这种奇怪的东西了，因为你们修改的同一块代码，当然会产生冲突. 

解决方案如下：

```java
假如我现在的1.txt中的冲突内容如下：
      <<<<<<< .mine

       6666666666666600000

       =======

      66666666666aaaaaaaaaa666

      >>>>>>> .r16
    前面说过  <<<<<<< .mine …… =======

    ……之间的代码是我未产生冲突之前修改的代码，

    ======= ………>>>>>>> .r16 这中间……的代码是别人与我冲突代码的部分，从上面的代码可以看到 aaaaaaaaa是我同事新增的 ,00000是我后增加的。
```

‍

使用revert(回滚)操作，该操作表示用户放弃自己的更新代码，然后直接提交，这个时候你的代码就会使服务器上最新的代码，即A用户提交的新代码

```java
点击ok按钮后 可以看到其他三个文件都自动删掉了，1.txt代码变成如下代码：

66666666666aaaaaaaaaa666

也就是a用户提交的代码，我自己更新的代码需要自己动手复制进去即可提交commit。
```

```java
假如我现在3.txt产生冲突代码如下：
<<<<<<< .mine

333333338888888888888=======

3333cccccccccc3333>>>>>>> .r16

通过第一点我们知道，333333338888888888888这个内容是我修改后，未产生冲突之前的内容，3333cccccccccc3333这个代码是A用户提交的代码，从上面得知 A用户新增内容是ccccccc，而我新增的内容是8888888。

```

那么第二种解决方法如下：

‍

选择文件->右键Editconficts：这种方法需要冲突双方经过协商之后将代码更改统一之后再提交. 不仅解决了冲突而且还保证了代码是正确的，因为只有一方的代码被提交.

‍

如上图所示，红色的部分是冲突代码：theirs表示当前服务器端最新的代码，Mine表示自己修改后的代码，Merged表示合并后的代码. 点击红色后右键选择：use this text block就可以将该部分代码作为合并后的代码

接下来再说说由于冲突导致重要代码被覆盖的情况. 冲突发生时如果采取的措施不对可能会导致部分代码丢失，如果想要还原之前的代码也很容易. 

选择文件->右键选择show log在这里面你可以看见之前提交的所有版本，找到你想要恢复的版本右键选择revert to this version 就可以恢复了

‍

**SVN提交(SVN Commit)**

Svn的提交是将在工作空间做的修改进行提交，包括文件内容的修改，文件或目录的添加，删除，命名，移动等操作

‍

**显示日志(Show log)**

通过此功能可以查到谁，什么时候，对那个目录下的那些文件进行了那些操作

‍

**版本库浏览(Repo-browser)**

此功能是用来浏览需要查看的资料库，在本地文件夹下点击右键，选择TortoiseSVNàRepo-browser,在弹出的对话框中输入资料库地址，再输入用户名和密码，就能查看到你需要查看到版本库的内容，在这你还能看到那些文件被谁锁定了

‍

‍

‍
