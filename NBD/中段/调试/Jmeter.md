‍

### Header

‍

‍

#### 环境

使用Jmeter时选择GUI模式还是Non GUI模式

> Don't use GUI mode for load testing !, only for Test creation and Test debugging

请不要使用GUI模式进行**负载测试**！GUI模式仅限于测试脚本的编写和调试。负载测试请用非界面模式。

‍

‍

# 知识

‍

## 评价

‍

### **测试工具对比**

* LoadRunner

  * 性能稳定，压测结果及细粒度大，可以自定义脚本进行压测，但是太过于重大，功能比较繁多
* Apache AB(单接口压测最方便)

  * 模拟多线程并发请求,ab命令对发出负载的计算机要求很低，既不会占用很多CPU，也不会占用太多的内存，但却会给目标服务器造成巨大的负载, 简单DDOS攻击等
* Webbench

  * webbench首先fork出多个子进程，每个子进程都循环做web访问测试. 子进程把访问的结果通过pipe告诉父进程，父进程做最终的统计结果.
* Jmeter
* 开源免费，功能强大，在互联网公司普遍使用
* 压测不同的协议和应用 1) Web - HTTP, HTTPS (Java, NodeJS, PHP, ASP.NET, …) 2) SOAP / REST Webservices 3) FTP 4) Database via JDBC 5) LDAP 轻量目录访问协议 6) Message-oriented middleware (MOM) via JMS 7) Mail - SMTP(S), POP3(S) and IMAP(S) 8) TCP等等
* 使用场景及优点 1）功能测试 2）压力测试 3）分布式压力测试 4）纯java开发 5）上手容易，高性能 4）提供测试数据分析 5）各种报表数据图形展示

‍

‍

‍

# 基础

‍

## 目录

‍

### 文件目录

```
bin:核心可执行文件，包含配置
        jmeter.bat: windows启动文件(window系统一定要配置显示文件拓展名)
        jmeter: mac或者linux启动文件
        jmeter-server：mac或者Liunx分布式压测使用的启动文件
        jmeter-server.bat：window分布式压测使用的启动文件
        jmeter.properties: 核心配置文件   
extras：插件拓展的包

lib:核心的依赖包
```

‍

### 菜单栏

**GUI菜单栏主要组件**

* 添加->threads->线程组（控制总体并发）

  ```
  线程数：虚拟用户数。一个虚拟用户占用一个进程或线程

  准备时长（Ramp-Up Period(in seconds)）：全部线程启动的时长，比如100个线程，20秒，则表示20秒内 100个线程都要启动完成，每秒启动5个线程

  循环次数：每个线程发送的次数，假如值为5，100个线程，则会发送500次请求，可以勾选永远循环
  ```
* 线程组->添加-> Sampler(采样器) -> Http （一个线程组下面可以增加几个Sampler）

  ```
  名称：采样器名称
  注释：对这个采样器的描述
  web服务器：
    默认协议是http
    默认端口是80
    服务器名称或IP ：请求的目标服务器名称或IP地址

  路径：服务器URL
  ```
* 查看测试结果

  ```
  线程组->添加->监听器->察看结果树 / 聚合报告
  ```

‍

## 搭建

‍

### 基础环境整合

Jmeter语言版本中英文切换

* 控制台修改 menu -> options -> choose language

‍

配置文件修改

* bin目录 -> jmeter.properties
* 默认 #language=en
* 改为 language=zh_CN

‍

‍

### **压测结果聚合报告**

‍

新增聚合报告：线程组->添加->监听器->聚合报告（Aggregate Report）

```
lable: sampler的名称
Samples: 一共发出去多少请求,例如10个用户，循环10次，则是 100
Average: 平均响应时间
Median: 中位数，也就是 50％ 用户的响应时间


90% Line : 90％ 用户的响应不会超过该时间 （90% of the samples took no more than this time.     The remaining samples at least as long as this）
95% Line : 95％ 用户的响应不会超过该时间
99% Line : 99％ 用户的响应不会超过该时间
min : 最小响应时间
max : 最大响应时间



Error%：错误的请求的数量/请求的总数
Throughput： 吞吐量——默认情况下表示每秒完成的请求数（Request per Second) 可类比为qps、tps
KB/Sec: 每秒接收数据量
```

‍

**1. 响应时间：** 指应用执行一个操作所需的时间，包括从发出请求开始到最后收到响应所需要的时间。响应时间的计算要考虑到用户的数目，用户数目越多，响应时间必须越快。

     聚合报告中体现接口响应时间的指标包含**平均值、中位数、90%百分位、95%百分位、99%百分位、最小值、最大值**，响应时间越小表示接口响应越快。实际工作中我们比较关注90%百分位这个值，表示90%的用户响应时间是小于578ms，平均响应时间参考意义不大

**2.**  **吞吐量：** 表示服务器分秒处理请求数或任务数。该值越大越好，表示服务器处理能力越强。

**3. 错误率：** 聚合报告中是指异常指标，错误率越低越好，为0表示没有异常请求。对于一般业务来说错误率要在万分之一以下。考虑到不同业务的区别，这个万分之一的标准可能会有变化。

**4. 带宽：** 在聚合报告中指Recived(KB/s)，表示从服务器端接受返回数据所占网络带宽。这个值一般要求越小越好，越小占用带宽越小，间接的表示服务器端返回数据较小。一般内网环境也就是千兆带宽，如果该值过大时，需要考虑优化。

‍

‍

## 使用

‍

### 线程组

测试计划上点鼠标右键，选择添加 > 线程（用户） > 线程组

在新增的线程组中，填写线程信息

> * 线程数    用户数量
> * Ramp-Up时间（秒)    例如10代表用户访问时间=10秒。表示100个用户10秒内完成，那每秒就是10次
> * 循环就是请求次数

‍

### 请求器

给线程组右键，添加http取样器：

编写取样器内容：必要参数

‍

### 汇总报告

添加监听报告：

给请求器右键监听器 - 汇总报告

‍

### 监听结果树

添加监听报告：

给请求器右键监听器 - 查看结果树

‍

# 实操

‍

## Bugfix
